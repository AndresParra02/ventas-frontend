<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Comisiones</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 500px;
      margin: 40px auto;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }
    #resultado {
      margin-top: 20px;
      padding: 10px;
      background: #f3f3f3;
    }
  </style>
</head>
<body>

  <h2>Calculadora de Comisiones</h2>

  <label>POS a POS</label>
  <input type="number" id="pos" value="0" min="0">

  <label>Migraci√≥n</label>
  <input type="number" id="migracion" value="0" min="0">

  <label>Pre</label>
  <input type="number" id="pre" value="0" min="0">

  <label>L√≠nea Nueva</label>
  <input type="number" id="linea" value="0" min="0">

  <button onclick="calcular()">Calcular comisi√≥n</button>

  <div id="resultado"></div>

<!-- Gamificaci√≥n -->
<div style="margin-top:20px">

  <div id="mensajePiso"></div>

  <label><strong>Progreso al siguiente piso</strong></label>
  <div style="background:#ddd; height:20px; border-radius:10px;">
    <div id="barraPiso" style="height:100%; width:0%; background:#4caf50; border-radius:10px;"></div>
  </div>

  <br>

  <label><strong>Progreso POS (objetivo 80%)</strong></label>
  <div style="background:#ddd; height:20px; border-radius:10px;">
    <div id="barraPos" style="height:100%; width:0%; background:#f44336; border-radius:10px;"></div>
  </div>

</div>

  
<script>
function calcular() {

  const puntosPorTipo = {
    pos: 1000,
    migracion: 1000,
    pre: 1000,
    linea: 1000
  };

  const ventas = {
    pos: Number(document.getElementById("pos").value),
    migracion: Number(document.getElementById("migracion").value),
    pre: Number(document.getElementById("pre").value),
    linea: Number(document.getElementById("linea").value)
  };

  const totalVentas =
    ventas.pos + ventas.migracion + ventas.pre + ventas.linea;

  let puntosTotales = 0;
  for (let tipo in ventas) {
    puntosTotales += ventas[tipo] * puntosPorTipo[tipo];
  }

  const pisos = [
    { puntos: 29000, comision: 500000 },
    { puntos: 32000, comision: 700000 },
    { puntos: 35000, comision: 900000 },
    { puntos: 38000, comision: 1100000 },
    { puntos: 41000, comision: 1300000 },
    { puntos: 44000, comision: 1500000 },
    { puntos: 47000, comision: 1700000 },
    { puntos: 50000, comision: 2000000 }
  ];

  let pisoNumero = 0;
  let comisionBase = 0;
  let puntosPisoActual = 0;
  let puntosProximoPiso = null;
  let comisionProxima = null;

  pisos.forEach((piso, index) => {
    if (puntosTotales >= piso.puntos) {
      pisoNumero = index + 1;
      comisionBase = piso.comision;
      puntosPisoActual = piso.puntos;
      if (pisos[index + 1]) {
        puntosProximoPiso = pisos[index + 1].puntos;
        comisionProxima = pisos[index + 1].comision;
      }
    }
  });

  // üìä Barra progreso piso
  if (puntosProximoPiso) {
    const progreso = Math.min(
      ((puntosTotales - puntosPisoActual) /
      (puntosProximoPiso - puntosPisoActual)) * 100,
      100
    );

    document.getElementById("barraPiso").style.width = progreso + "%";

    const puntosFaltantes = puntosProximoPiso - puntosTotales;
    const gananciaExtra = comisionProxima - comisionBase;

    document.getElementById("mensajePiso").innerHTML = `
      <br><strong>üöÄ Pr√≥ximo objetivo: Piso ${pisoNumero + 1}</strong><br>
      Te faltan <strong>${puntosFaltantes}</strong> puntos<br>
      Ganas <strong>$${gananciaExtra.toLocaleString()}</strong> m√°s
    `;
  } else {
    document.getElementById("barraPiso").style.width = "100%";
    document.getElementById("mensajePiso").innerHTML =
      "<br><strong>üèÜ Est√°s en el piso m√°ximo</strong>";
  }

  // üí∞ Bono POS
  const bonoPosPorPiso = { 4:4000, 5:5000, 6:6000, 7:7000, 8:8000 };
  let bonoPos = 0;
  let mensajeBono = "";

  let porcentajePos = totalVentas > 0 ? ventas.pos / totalVentas : 0;
  let porcentajePosUI = Math.min(porcentajePos * 100, 100);

  document.getElementById("barraPos").style.width = porcentajePosUI + "%";
  document.getElementById("barraPos").style.background =
    porcentajePos >= 0.8 ? "#4caf50" : "#f44336";

  if (pisoNumero >= 4 && bonoPosPorPiso[pisoNumero]) {
    if (porcentajePos >= 0.8) {
      bonoPos = ventas.pos * bonoPosPorPiso[pisoNumero];
      mensajeBono = `
        <br><strong>üî• Bono POS ACTIVADO</strong><br>
        Bono: $${bonoPos.toLocaleString()}
      `;
    } else {
      const posFaltantes = Math.ceil(
        (0.8 * totalVentas - ventas.pos) / 0.2
      );
      mensajeBono = `
        <br><strong>‚ö° Te faltan ${posFaltantes} POS</strong> para activar el bono
      `;
    }
  }

  const totalPagar = comisionBase + bonoPos;

  document.getElementById("resultado").innerHTML = `
    <strong>Puntos:</strong> ${puntosTotales}<br>
    <strong>Piso:</strong> ${pisoNumero || "No alcanz√≥ meta"}<br>
    <strong>Comisi√≥n base:</strong> $${comisionBase.toLocaleString()}
    ${mensajeBono}
    <br><br>
    <strong>üí∞ Total a pagar:</strong> $${totalPagar.toLocaleString()}
  `;
}
</script>


</body>
</html>
